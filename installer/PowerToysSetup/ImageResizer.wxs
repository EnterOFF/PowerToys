<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension" >

  <?include $(sys.CURRENTDIR)\Common.wxi?>

  <?define ImageResizerFiles=?>
  <?define ImageResizerFilesPath=$(var.BinDir)modules\$(var.ImageResizerProjectName)\?>

  <Fragment>
    <DirectoryRef Id="ImageResizerInstallFolder" FileSource="$(var.BinDir)modules\$(var.ImageResizerProjectName)">
    <!-- Generated by generateFileComponents.ps1 -->
    <!--ImageResizerFiles_Component_Def-->

      <Component Id="Module_ImageResizer_Registry" Win64="yes">
        <RegistryKey Root="HKCU" Key="Software\Classes\CLSID\{51B4D7E5-7568-4234-B4BB-47FB3C016A69}\InprocServer32">
          <RegistryValue Value="[ImageResizerInstallFolder]PowerToys.ImageResizerExt.dll" Type="string" />
          <RegistryValue Name="ThreadingModel" Value="Apartment" Type="string" />
        </RegistryKey>

        <!-- Registry Key for the drag and drop handler -->
        <!-- To use later on when we want to install per user.
                <RegistryValue Root="HKCU"
                               Key="Software\Classes\Directory\ShellEx\DragDropHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
                               -->
        <RegistryValue Root="HKCU"
                       Key="SOFTWARE\Classes\Directory\ShellEx\DragDropHandlers\ImageResizer"
                       Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                       Type="string" />
        <!-- Registry Keys for the context menu handler for each of the following image formats: bmp, dib, gif, jfif, jpe, jpeg, jpg, jxr, png, rle, tif, tiff, wdp  -->
        <RegistryValue Root="HKCU"
                         Key="SOFTWARE\Classes\SystemFileAssociations\.bmp\ShellEx\ContextMenuHandlers\ImageResizer"
                         Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                         Type="string" />
        <RegistryValue Root="HKCU"
                       Key="SOFTWARE\Classes\SystemFileAssociations\.dib\ShellEx\ContextMenuHandlers\ImageResizer"
                       Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                       Type="string" />
        <RegistryValue Root="HKCU"
                       Key="SOFTWARE\Classes\SystemFileAssociations\.gif\ShellEx\ContextMenuHandlers\ImageResizer"
                       Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                       Type="string" />
        <RegistryValue Root="HKCU"
                       Key="SOFTWARE\Classes\SystemFileAssociations\.jfif\ShellEx\ContextMenuHandlers\ImageResizer"
                       Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                       Type="string" />
        <RegistryValue Root="HKCU"
                       Key="SOFTWARE\Classes\SystemFileAssociations\.jpe\ShellEx\ContextMenuHandlers\ImageResizer"
                       Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                       Type="string" />
        <RegistryValue Root="HKCU"
                       Key="SOFTWARE\Classes\SystemFileAssociations\.jpeg\ShellEx\ContextMenuHandlers\ImageResizer"
                       Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                       Type="string" />
        <RegistryValue Root="HKCU"
                       Key="SOFTWARE\Classes\SystemFileAssociations\.jpg\ShellEx\ContextMenuHandlers\ImageResizer"
                       Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                       Type="string" />
        <RegistryValue Root="HKCU"
                       Key="SOFTWARE\Classes\SystemFileAssociations\.jxr\ShellEx\ContextMenuHandlers\ImageResizer"
                       Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                       Type="string" />
        <RegistryValue Root="HKCU"
                       Key="SOFTWARE\Classes\SystemFileAssociations\.png\ShellEx\ContextMenuHandlers\ImageResizer"
                       Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                       Type="string" />
        <RegistryValue Root="HKCU"
                       Key="SOFTWARE\Classes\SystemFileAssociations\.rle\ShellEx\ContextMenuHandlers\ImageResizer"
                       Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                       Type="string" />
        <RegistryValue Root="HKCU"
                       Key="SOFTWARE\Classes\SystemFileAssociations\.tif\ShellEx\ContextMenuHandlers\ImageResizer"
                       Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                       Type="string" />
        <RegistryValue Root="HKCU"
                       Key="SOFTWARE\Classes\SystemFileAssociations\.tiff\ShellEx\ContextMenuHandlers\ImageResizer"
                       Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                       Type="string" />
        <RegistryValue Root="HKCU"
                       Key="SOFTWARE\Classes\SystemFileAssociations\.wdp\ShellEx\ContextMenuHandlers\ImageResizer"
                       Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                       Type="string" />
      </Component>
    </DirectoryRef>

    <DirectoryRef Id="ImageResizerAssetsFolder" FileSource="$(var.BinDir)modules\$(var.ImageResizerProjectName)">
      <Component Id="ImageResizerSparsePackageAssets_LargeTile.png" Win64="yes">
        <File Id="ImageResizerSparsePackageAssetsFile_LargeTile.png" Source="$(var.BinDir)modules\$(var.ImageResizerProjectName)\Assets\LargeTile.png" />
      </Component>
      <Component Id="ImageResizerSparsePackageAssets_SmallTile.png" Win64="yes">
        <File Id="ImageResizerSparsePackageAssetsFile_SmallTile.png" Source="$(var.BinDir)modules\$(var.ImageResizerProjectName)\Assets\SmallTile.png" />
      </Component>
      <Component Id="ImageResizerSparsePackageAssets_SplashScreen.png" Win64="yes">
        <File Id="ImageResizerSparsePackageAssetsFile_SplashScreen.png" Source="$(var.BinDir)modules\$(var.ImageResizerProjectName)\Assets\SplashScreen.png" />
      </Component>
      <Component Id="ImageResizerSparsePackageAssets_Square150x150Logo.png" Win64="yes">
        <File Id="ImageResizerSparsePackageAssetsFile_Square150x150Logo.png" Source="$(var.BinDir)modules\$(var.ImageResizerProjectName)\Assets\Square150x150Logo.png" />
      </Component>
      <Component Id="ImageResizerSparsePackageAssets_Square44x44Logo.png" Win64="yes">
        <File Id="ImageResizerSparsePackageAssetsFile_Square44x44Logo.png" Source="$(var.BinDir)modules\$(var.ImageResizerProjectName)\Assets\Square44x44Logo.png" />
      </Component>
      <Component Id="ImageResizerSparsePackageAssets_storelogo.png" Win64="yes">
        <File Id="ImageResizerSparsePackageAssetsFile_storelogo.png" Source="$(var.BinDir)modules\$(var.ImageResizerProjectName)\Assets\storelogo.png" />
      </Component>
      <Component Id="ImageResizerSparsePackageAssets_Wide310x150Logo.png" Win64="yes">
        <File Id="ImageResizerSparsePackageAssetsFile_Wide310x150Logo.png" Source="$(var.BinDir)modules\$(var.ImageResizerProjectName)\Assets\Wide310x150Logo.png" />
      </Component>
    </DirectoryRef>

    <ComponentGroup Id="ImageResizerComponentGroup" Directory="INSTALLFOLDER">
      <?foreach File in $(var.ImageResizerFiles)?>
        <ComponentRef Id="ImageResizerFiles_Comp_$(var.File)" />
      <?endforeach?>
      <ComponentRef Id="ImageResizerSparsePackageAssets_LargeTile.png" />
      <ComponentRef Id="ImageResizerSparsePackageAssets_SmallTile.png" />
      <ComponentRef Id="ImageResizerSparsePackageAssets_SplashScreen.png" />
      <ComponentRef Id="ImageResizerSparsePackageAssets_Square150x150Logo.png" />
      <ComponentRef Id="ImageResizerSparsePackageAssets_Square44x44Logo.png" />
      <ComponentRef Id="ImageResizerSparsePackageAssets_storelogo.png" />
      <ComponentRef Id="ImageResizerSparsePackageAssets_Wide310x150Logo.png" />
      <ComponentRef Id="Module_ImageResizer_Registry" />
    </ComponentGroup>
  </Fragment>
</Wix>
